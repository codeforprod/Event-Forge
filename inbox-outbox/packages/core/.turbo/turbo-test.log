
> @event-forge/inbox-outbox-core@1.0.0 test /private/var/folders/3s/f088p7sn0w583k6py57jw29h0000gn/T/vibe-kanban/worktrees/4142-create-universal/Event-Forge/inbox-outbox/packages/core
> jest

watchman warning:  Recrawled this watch 23 times, most recently because:
MustScanSubDirs UserDroppedTo resolve, please review the information on
https://facebook.github.io/watchman/docs/troubleshooting.html#recrawl
To clear this warning, run:
`watchman watch-del '/private/var/folders/3s/f088p7sn0w583k6py57jw29h0000gn/T/vibe-kanban/worktrees/4142-create-universal/Event-Forge' ; watchman watch-project '/private/var/folders/3s/f088p7sn0w583k6py57jw29h0000gn/T/vibe-kanban/worktrees/4142-create-universal/Event-Forge'`

PASS @event-forge/inbox-outbox-core src/services/__tests__/outbox.service.spec.ts
  OutboxService
    createMessage
      ✓ should create a message with default maxRetries (2 ms)
      ✓ should create a message with custom maxRetries (1 ms)
      ✓ should create a message within a transaction context
      ✓ should emit MESSAGE_CREATED event when immediateProcessing is enabled
    withTransaction
      ✓ should execute operation within a transaction
    startPolling
      ✓ should emit POLLING_STARTED event
      ✓ should not start multiple polling timers (1 ms)
      ○ skipped should start polling at configured interval
    stopPolling
      ✓ should emit POLLING_STOPPED event
      ✓ should stop polling (1 ms)
    pollAndProcess
      ✓ should release stale locks before fetching messages
      ✓ should fetch and process pending messages (1 ms)
      ✓ should emit error on processing failure but continue polling
      ○ skipped should not process concurrently
    publishMessage
      ✓ should publish message and mark as published
      ✓ should handle publish errors with retry (1 ms)
      ✓ should mark as permanently failed when max retries exceeded
      ✓ should mark as permanently failed for ProcessingError
    cleanup
      ✓ should delete old published messages (3 ms)
      ✓ should emit cleanup event with deleted count (2 ms)
      ✓ should not emit cleanup event when no messages deleted (3 ms)
      ✓ should handle cleanup errors gracefully (3 ms)
    configuration
      ✓ should use custom configuration
      ✓ should merge custom config with defaults

PASS @event-forge/inbox-outbox-core src/services/__tests__/inbox.service.spec.ts
  InboxService
    registerHandler
      ✓ should register a handler for an event type
      ✓ should register multiple handlers for the same event type
      ✓ should register handlers for different event types
    unregisterHandler
      ✓ should unregister a specific handler (1 ms)
      ✓ should handle unregistering non-existent handler
      ✓ should handle unregistering from non-existent event type
      ✓ should remove event type when last handler is unregistered
    receiveMessage
      ✓ should record and process a new message
      ✓ should throw DuplicateMessageError for duplicate messages (7 ms)
      ✓ should emit MESSAGE_RECEIVED event (1 ms)
    processMessage
      ✓ should process message with registered handlers
      ✓ should mark as processed when no handlers registered (1 ms)
      ✓ should emit MESSAGE_PROCESSED event
      ✓ should execute all handlers in parallel (102 ms)
      ✓ should handle ProcessingError as permanent failure (1 ms)
      ✓ should handle generic errors
      ✓ should handle non-Error exceptions (1 ms)
    cleanup
      ✓ should start cleanup timer
      ✓ should not start multiple cleanup timers (1 ms)
      ✓ should delete old processed messages
      ✓ should emit cleanup event with deleted count
      ✓ should not emit cleanup event when no messages deleted
      ✓ should handle cleanup errors gracefully
      ✓ should stop cleanup timer (1 ms)
    configuration
      ✓ should use custom configuration
      ✓ should merge custom config with defaults

Test Suites: 2 passed, 2 total
Tests:       2 skipped, 48 passed, 50 total
Snapshots:   0 total
Time:        0.725 s, estimated 1 s
Ran all test suites.
